<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="ie=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=author content>
<meta name=description content="I started learning SwiftUI around August 2020 first with Apple&amp;rsquo;s SwiftUI Tutorials. The tutorials were really fun and got me excited with using SwiftUI. I then continued with Paul Hudson&amp;rsquo;s series 100 Days of SwiftUI. Around the end of series, I could not hesitate any longer so I started a new Xcode project and build one of the things I like most about Slack app: the emoji picker!
The point of the Happy Panel project was to learn SwiftUI and make use of its declarative syntax to build a complicated control with gestures and animations in a few lines of code.">
<meta name=keywords content="swift,learning,tech,apps,swift,swiftui,emojis">
<meta name=robots content="noodp">
<meta name=theme-color content>
<link rel=canonical href=/posts/swiftui-happy-panel/>
<title>
Learning SwiftUI by Building a Slack-like Emoji Picker :: üçì Huong Do
</title>
<link href=https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css rel=stylesheet type=text/css>
<link rel=stylesheet href=/main.1ba7d26d0c4324706d3a8a940ddf4a745defa78b99020c5643d5b32b6074a5ba.css>
<meta itemprop=name content="Learning SwiftUI by Building a Slack-like Emoji Picker">
<meta itemprop=description content="I started learning SwiftUI around August 2020 first with Apple&rsquo;s SwiftUI Tutorials. The tutorials were really fun and got me excited with using SwiftUI. I then continued with Paul Hudson&rsquo;s series 100 Days of SwiftUI. Around the end of series, I could not hesitate any longer so I started a new Xcode project and build one of the things I like most about Slack app: the emoji picker!
The point of the Happy Panel project was to learn SwiftUI and make use of its declarative syntax to build a complicated control with gestures and animations in a few lines of code."><meta itemprop=datePublished content="2020-09-02T21:23:02+07:01">
<meta itemprop=dateModified content="2020-09-02T21:23:02+07:01">
<meta itemprop=wordCount content="1117"><meta itemprop=image content="/">
<meta itemprop=keywords content="swift,swiftui,emojis,">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="/">
<meta name=twitter:title content="Learning SwiftUI by Building a Slack-like Emoji Picker">
<meta name=twitter:description content="I started learning SwiftUI around August 2020 first with Apple&rsquo;s SwiftUI Tutorials. The tutorials were really fun and got me excited with using SwiftUI. I then continued with Paul Hudson&rsquo;s series 100 Days of SwiftUI. Around the end of series, I could not hesitate any longer so I started a new Xcode project and build one of the things I like most about Slack app: the emoji picker!
The point of the Happy Panel project was to learn SwiftUI and make use of its declarative syntax to build a complicated control with gestures and animations in a few lines of code.">
<meta property="og:title" content="Learning SwiftUI by Building a Slack-like Emoji Picker">
<meta property="og:description" content="I started learning SwiftUI around August 2020 first with Apple&rsquo;s SwiftUI Tutorials. The tutorials were really fun and got me excited with using SwiftUI. I then continued with Paul Hudson&rsquo;s series 100 Days of SwiftUI. Around the end of series, I could not hesitate any longer so I started a new Xcode project and build one of the things I like most about Slack app: the emoji picker!
The point of the Happy Panel project was to learn SwiftUI and make use of its declarative syntax to build a complicated control with gestures and animations in a few lines of code.">
<meta property="og:type" content="article">
<meta property="og:url" content="/posts/swiftui-happy-panel/"><meta property="og:image" content="/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2020-09-02T21:23:02+07:01">
<meta property="article:modified_time" content="2020-09-02T21:23:02+07:01"><meta property="og:site_name" content="üçì Huong Do">
<meta property="article:published_time" content="2020-09-02 21:23:02 +0701 +0701">
</head>
<body class=dark-theme>
<div class=container>
<header class=header>
<span class=header__inner>
<a href=/ style=text-decoration:none>
<div class=logo>
<span class=logo__mark>></span>
<span class=logo__text>cd home/</span>
<span class=logo__cursor>
</span>
</div>
</a>
<span class=header__right>
<nav class=menu>
<ul class=menu__inner><li><a href=/about>about</a></li><li><a href=/posts>posts</a></li>
</ul>
</nav>
<span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
</span>
<span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg>
</span>
</span>
</span>
</header>
<div class=content>
<main class=post>
<div class=post-info>
<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
6 minutes
</p>
</div>
<article>
<h1 class=post-title>
<a href=/posts/swiftui-happy-panel/>Learning SwiftUI by Building a Slack-like Emoji Picker</a>
</h1>
<div class=post-content>
<p>I started learning SwiftUI around August 2020 first with <a href=https://developer.apple.com/tutorials/SwiftUI>Apple&rsquo;s SwiftUI Tutorials</a>. The tutorials were really fun and got me excited with using SwiftUI. I then continued with Paul Hudson&rsquo;s series <a href=https://www.hackingwithswift.com/100/swiftui>100 Days of SwiftUI</a>. Around the end of series, I could not hesitate any longer so I started a new Xcode project and build one of the things I like most about Slack app: the emoji picker!</p>
<p><img src="https://github.com/itsmeichigo/HappyPanel/blob/master/screenshot.png?raw=true" alt="Happy Panel"></p>
<p>The point of the <a href=https://github.com/itsmeichigo/HappyPanel>Happy Panel project</a> was to learn SwiftUI and make use of its declarative syntax to build a complicated control with gestures and animations in a few lines of code. Because the biggest motivation for me to learn something new is to be able to make something beautiful and performant.</p>
<p>Below is how I tried to solve the problem - more like a note on what I learned.</p>
<h1 id=starting-out-with-the-smallest-components-first>Starting out with the smallest components first</h1>
<ul>
<li>Search bar: essentially a text field with grey background color and search icon on the left. Search button should show up when the field is focused and disappear otherwise.</li>
<li>Emoji grid: a grid of buttons that returns the content to its parent when tapped. The grid can be built with a combination of VStack and HStack (which requires a 2-dimensional array), but SwiftUI 2 provides grid which is super helpful so I used LazyVGrid instead. This is a toy project, I don&rsquo;t care about users using iOS 13 anyway.</li>
<li>List with section headers containing the emoji grid. The cool thing about SwiftUI is that a lot of UI components are supported natively without much needed code and here&rsquo;s one of them: a <code>List</code> wrapping around a <code>Section</code> with header will give you a table view with sticky headers. This is way too convenient comparing to how I&rsquo;d have had to implement the same thing with UIKit.</li>
<li>Search result rows for filtered emojis.</li>
<li>Search result list.</li>
<li>Main content view: containing all the above components.</li>
<li>Section title picker to navigate between sections. I want this to float above the main content view so it&rsquo;s not contained in the main content view.</li>
<li>Main panel: containing a dimmed background, the main content view and the section title picker.</li>
</ul>
<h1 id=navigating-between-sections>Navigating between sections</h1>
<p>With the help of <code>ScrollViewReader</code> and <code>ScrollViewProxy</code>, navigating to a desired section of a list is so easy with a simple <code>scrollTo(_ id:)</code> function. The problem is I had to learn how to use it the hard way with very much frustration involved.</p>
<p>The magic of <code>ScrollViewProxy</code> is that it scans through the children to find the view with the <code>id</code> that you send it. It&rsquo;s as simple as that, but at first I tried to call the scroll function on the <code>List</code>, which crashes the app since my <code>List</code> doesn&rsquo;t immediately contain the view that I was looking for, but has it embeded inside a child <code>ForEach</code>. Moving the call downward to the child was the solution that took me almost a whole day.</p>
<p>There&rsquo;s a feature that I have yet to implement. It is expected that when the emoji grid is scrolled the section picker updates its selected segment accordingly. As far as I know this is natively impossible since SwiftUI <code>List</code> doesn&rsquo;t offer a way to read the current offset but if it does some day, I think I can compare the offset with the pre-calculated frame of each section. This is still fugly, and also when I can determine the current visible section and update the <code>currentCategory</code> environment variable, it would cause a circular reference since the picker itself is listening on any change of this variable to scroll to the correct section. So is there a better solution?</p>
<h1 id=moving-the-main-panel-with-drag-gesture>Moving the main panel with drag gesture</h1>
<p>Updating the main panel offset with drag gesture isn&rsquo;t the hardest part to begin with. I keep the 2 variables - one for the calculated offset and one for the last offset when the dragging gesture ends, which is used for calculated the first variable. Then I have some magic code to magnetize the panel to the top or close the panel based on where the gesture ends.</p>
<p>A problem I noticed was that if I move the main content view&rsquo;s code to main panel, the dragging performance suffers. I keep the same code and move it to a separate file, the dragging gets as smooth as it can ever get. This remains a mystery to me.</p>
<p>There&rsquo;s a challenge here though. Slack utilizes the drag gesture on the emoji grid view very well, when the panel is in half mode you can&rsquo;t scroll the grid but instead can only drag the panel. I tried to mimick this behavior but there&rsquo;s no native way to do intervene the scrolling behavior of the <code>List</code>. So I just leave it there and wait to see when SwiftUI provides such feature, if ever.</p>
<h1 id=environmentobject>@EnvironmentObject</h1>
<p>Originally I used a lot of <code>@State</code> and <code>@Binding</code> to send some states back and forth between children and parent views. I then decided to clean the mess up by using <code>@EnvironmentObject</code> so that all children and parents can have access to the same states of the view. This causes me to think if this is the intended behavior of the property wrapper itself - if it makes the state globablly available to all the listeners to both read and write, would it be safe? Like I may have some code in a view that has nothing to do with search keyword but alter the variable and the control will break. If SwiftUI&rsquo;s main purpose is to maintain states in a clean way then my usage of @EnvironmentObject is totally against the rule.</p>
<h1 id=an-open-ending-updated-in-july-2021>An open ending (updated in July 2021)</h1>
<p>I left the project with an open ending due to several challenges:</p>
<p>I have yet to handle <code>List</code> to behave properly to pan gesture. You can see some performance hitch when dragging the panel back and forth. In WWDC21 Apple introduced <a href=https://developer.apple.com/documentation/uikit/uisheetpresentationcontroller>UISheetPresentationController</a> - however this is not available natively on SwiftUI. It is possible to use wrapper though, as per <a href=https://www.donnywals.com/using-uisheetpresentationcontroller-in-swiftui/>Donny Wal&rsquo;s article</a>. I will need to look at that and see how I can improve the panel for iOS 15+.</p>
<p>As mentioned earlier, section picker needs to be updated when scrolling to respective sections. I have found a solution for this in a Mac app (more on that right below) - but the solution is not feasible on the floating panel due to the complication of gesture recognizers.</p>
<p>On a flip side, I started a menu bar app on MacOS and it was actually really fun since Mac app development is all new to me. I will note my learning on a separate post, so please stay tuned!</p>
<p>Until next time! üëã</p>
</div>
</article>
<hr>
<div class=post-info>
<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg>
<span class=tag><a href=/tags/swift/>swift</a></span>
<span class=tag><a href=/tags/swiftui/>swiftui</a></span>
<span class=tag><a href=/tags/emojis/>emojis</a></span>
</p>
<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
1117 Words
</p>
<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
2020-09-02 14:22
</p>
</div>
<hr>
<div class=sharing-buttons>
<a class=resp-sharing-button__link href="https://facebook.com/sharer/sharer.php?u=%2fposts%2fswiftui-happy-panel%2f" target=_blank rel=noopener aria-label title="Share on facebook">
<div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 2h-3a5 5 0 00-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 011-1h3z"/></svg>
</div>
</div>
</a>
<a class=resp-sharing-button__link href="https://twitter.com/intent/tweet/?url=%2fposts%2fswiftui-happy-panel%2f" target=_blank rel=noopener aria-label title="Share on twitter">
<div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--small">
<div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg>
</div>
</div>
</a>
<a class=resp-sharing-button__link href="mailto:?subject=Learning%20SwiftUI%20by%20Building%20a%20Slack-like%20Emoji%20Picker&body=%2fposts%2fswiftui-happy-panel%2f" target=_self rel=noopener aria-label title="Share via email">
<div class="resp-sharing-button resp-sharing-button--email resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
</div>
</div>
</a>
</div>
<div class=pagination>
<div class=pagination__title>
<span class=pagination__title-h>Read other posts</span>
<hr>
</div>
<div class=pagination__buttons>
<span class="button previous">
<a href=/posts/combine-from-rxswift/>
<span class=button__icon>‚Üê</span>
<span class=button__text>Combine from RxSwift - Highlights for smooth adaption</span>
</a>
</span>
</div>
</div>
</main>
</div>
<footer class=footer>
<div class=footer__inner>
<div class=footer__content>
<span>&copy; 2022</span>
<span>Huong Do</span>
<span><a href=/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></span>
</div>
</div>
</footer>
</div>
<script type=text/javascript src=/bundle.min.a0f363fdf81cdc5cfacc447a79c33189eb000d090336cd04aac8ee256f423b3133b836c281944c19c75e38d0b0b449f01ce5807e37798b7ac94ac1db51983fc4.js integrity="sha512-oPNj/fgc3Fz6zER6ecMxiesADQkDNs0EqsjuJW9COzEzuDbCgZRMGcdeONCwtEnwHOWAfjd5i3rJSsHbUZg/xA=="></script>
</body>
</html>