<!doctype html><html lang=en><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content><meta name=description content="Last week, I wanted to add an update to one of my mac apps Peachy after a long time. I realized that the atool used for notarizing mac apps has long been discontinued and it was time to switch to notarytool. It took me a while to read through Apple documentations and WWDC videos again to finally be able to distribute a working DMG for the new version.
I had some free time due to the Lunar new year holiday, so this was an opportunity to learn something new. It&rsquo;s time to automate the distribution process for my mac apps, and a CLI tool is a perfect solution for this.
"><meta name=keywords content="itsmeichigo,blog,apps,cli,swiftpm,swift,mac-app"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=/posts/dmg-notary/><title>Building a CLI tool with SwiftPM for Mac app distribution | Huong Do</title><link rel=stylesheet href=/main.min.b40b8806a3821a94f2961fb4f44a1bd3bbf354ce3fdec68ee7c36a02d45e713c.css integrity="sha256-tAuIBqOCGpTylh+09Eob07vzVM4/3saO58NqAtRecTw=" crossorigin=anonymous><meta itemprop=name content="Building a CLI tool with SwiftPM for Mac app distribution"><meta itemprop=description content="Last week, I wanted to add an update to one of my mac apps Peachy after a long time. I realized that the atool used for notarizing mac apps has long been discontinued and it was time to switch to notarytool. It took me a while to read through Apple documentations and WWDC videos again to finally be able to distribute a working DMG for the new version.
I had some free time due to the Lunar new year holiday, so this was an opportunity to learn something new. It’s time to automate the distribution process for my mac apps, and a CLI tool is a perfect solution for this."><meta itemprop=datePublished content="2024-02-12T17:00:00+07:01"><meta itemprop=dateModified content="2024-02-12T17:00:00+07:01"><meta itemprop=wordCount content="498"><meta itemprop=image content="/"><meta itemprop=keywords content="Cli,Swiftpm,Swift,Mac-App"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="/"><meta name=twitter:title content="Building a CLI tool with SwiftPM for Mac app distribution"><meta name=twitter:description content="Last week, I wanted to add an update to one of my mac apps Peachy after a long time. I realized that the atool used for notarizing mac apps has long been discontinued and it was time to switch to notarytool. It took me a while to read through Apple documentations and WWDC videos again to finally be able to distribute a working DMG for the new version.
I had some free time due to the Lunar new year holiday, so this was an opportunity to learn something new. It’s time to automate the distribution process for my mac apps, and a CLI tool is a perfect solution for this."><meta property="og:url" content="/posts/dmg-notary/"><meta property="og:site_name" content="Huong Do"><meta property="og:title" content="Building a CLI tool with SwiftPM for Mac app distribution"><meta property="og:description" content="Last week, I wanted to add an update to one of my mac apps Peachy after a long time. I realized that the atool used for notarizing mac apps has long been discontinued and it was time to switch to notarytool. It took me a while to read through Apple documentations and WWDC videos again to finally be able to distribute a working DMG for the new version.
I had some free time due to the Lunar new year holiday, so this was an opportunity to learn something new. It’s time to automate the distribution process for my mac apps, and a CLI tool is a perfect solution for this."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-02-12T17:00:00+07:01"><meta property="article:modified_time" content="2024-02-12T17:00:00+07:01"><meta property="article:tag" content="Cli"><meta property="article:tag" content="Swiftpm"><meta property="article:tag" content="Swift"><meta property="article:tag" content="Mac-App"><meta property="og:image" content="/"><meta property="article:published_time" content="2024-02-12 17:00:00 +0701 +0701"></head><body class=dark-theme><div class=container><header class=header><span class=header__inner><a href=/ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>cd home/</span>
<span class=logo__cursor></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=/about>about</a></li><li><a href=/apps>apps</a></li><li><a href=/posts>posts</a></li></ul></nav><span class=menu-trigger><svg viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
</span><span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
3 minutes</p></div><article><h1 class=post-title><a href=/posts/dmg-notary/>Building a CLI tool with SwiftPM for Mac app distribution</a></h1><div class=post-content><p>Last week, I wanted to add an update to one of my mac apps <a href=https://itsmeichigo.io/peachy>Peachy</a> after a long time. I realized that the <code>atool</code> used for notarizing mac apps has long been discontinued and it was time to switch to <a href=https://developer.apple.com/documentation/security/notarizing_macos_software_before_distribution><code>notarytool</code></a>. It took me a while to read through Apple documentations and WWDC videos again to finally be able to distribute a working DMG for the new version.</p><p>I had some free time due to the Lunar new year holiday, so this was an opportunity to learn something new. It&rsquo;s time to automate the distribution process for my mac apps, and a CLI tool is a perfect solution for this.</p><p>First thing first, I went to my trusted friend Google (not ChatGPT, surprise 👻) - and looked for a quick tutorial to build a CLI tool in Swift. Surprisingly, all of the tutorials I found were outdated, except for the <del>bible</del> <a href=https://www.swift.org/getting-started/cli-swiftpm/>documentation</a>. This post will sum up things that I learned during the process.</p><h2 id=getting-started>Getting Started</h2><p>The first thing to do is create a Swift package of executable type:</p><pre tabindex=0><code>$ swift package init --name dmg-notary --type executable
</code></pre><p>I used Swift 5.9, and the newly created package contained the <code>Package.swift</code> file defining the main target as <code>.executableTarget</code>. I went ahead to add <a href=https://apple.github.io/swift-argument-parser/documentation/argumentparser/gettingstarted/>ArgumentParser</a> as a dependency. This is essential for setting up and customizing a CLI tool.</p><p>The default package came with a <code>main.swift</code> file. We can create a <code>struct</code> in this file and trigger its <code>.main()</code> method. Since Swift 5.3, we can rename the file to the same as the type and mark it as the entry point with <code>@main</code>. This is the best practice since it makes the project structure cleaner and more organized.</p><p>The root <code>struct</code> needs to conform to the <code>PassableCommand</code> protocol and define the arguments and options for the CLI tool.</p><p>Another cool dependency is <a href=https://github.com/JohnSundell/ShellOut><code>ShellOut</code></a> which is helpful for triggering command lines from our Swift scripts.</p><h2 id=implementation-highlights>Implementation highlights</h2><p><code>dmg-notary</code> was inspired by <a href=https://github.com/insidegui/dmgdist><code>dmgdist</code></a>, which also depends on <a href=https://github.com/sindresorhus/create-dmg><code>create-dmg</code></a> for generating a DMG from an app file. The first part of the script uses <code>shellout</code> to trigger the <code>create-dmg</code> command for this step.</p><p>The second part of the script triggers commands to <code>notarytool</code> to handle the notarization step. Due to the proxy, I had to handle the edge case when the user opts to enter their password separately instead of providing it in plain text in the command. The goal was to keep their password field hidden rather than plain text with <code>readline()</code>. I learned about <code>getpass</code> (and also the term <a href=https://en.wikipedia.org/wiki/Shoulder_surfing_%28computer_security%29>shoulder surfing</a>), which was the solution to this problem.</p><h2 id=conclusion>Conclusion</h2><p>The sourcecode of dmg-notary can be found on my Github <a href=https://github.com/itsmeichigo/dmg-notary>repo</a>.</p><h2 id=alternative-notarization-method>Alternative notarization method</h2><p>A simpler way to notarize mac apps is to add a post-action script to the Archive step of your app&rsquo;s scheme. More details can be found <a href=https://developer.apple.com/documentation/security/notarizing_macos_software_before_distribution/customizing_the_notarization_workflow/customizing_the_xcode_archive_process>here</a>.</p><h2 id=references>References</h2><ul><li><a href=https://developer.apple.com/documentation/security/notarizing_macos_software_before_distribution>Notarizing MacOS software before distribution</a></li><li><a href=https://www.swift.org/getting-started/cli-swiftpm/>Build a command-line tool</a></li><li><a href=https://rderik.com/blog/how-to-read-passwords-and-sensitive-data-from-the-command-line-using-swift/>How to read passwords and sensitive data from the command-line using Swift</a></li></ul></div></article><hr><div class=post-info><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg>
<span class=tag><a href=/tags/cli/>cli</a></span>
<span class=tag><a href=/tags/swiftpm/>swiftpm</a></span>
<span class=tag><a href=/tags/swift/>swift</a></span>
<span class=tag><a href=/tags/mac-app/>mac-app</a></span></p><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
498 Words</p><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
2024-02-12 09:59</p></div><hr><div class=sharing-buttons><a class=resp-sharing-button__link href="https://facebook.com/sharer/sharer.php?u=%2fposts%2fdmg-notary%2f" target=_blank rel=noopener aria-label title="Share on facebook"><div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 2h-3a5 5 0 00-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 011-1h3z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://twitter.com/intent/tweet/?url=%2fposts%2fdmg-notary%2f" target=_blank rel=noopener aria-label title="Share on twitter"><div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></div></div></a><a class=resp-sharing-button__link href="mailto:?subject=Building%20a%20CLI%20tool%20with%20SwiftPM%20for%20Mac%20app%20distribution&amp;body=%2fposts%2fdmg-notary%2f" target=_self rel=noopener aria-label title="Share via email"><div class="resp-sharing-button resp-sharing-button--email resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></div></div></a></div><div class=pagination><div class=pagination__title><span class=pagination__title-h></span><hr></div><div class=pagination__buttons><span class="button next"><a href=/posts/jot-it-down/><span class=button__text>Releasing Jot It Down 🗒️</span>
<span class=button__icon>→</span></a></span></div></div></main></div><footer class=footer><div class=footer__inner><div class=footer__content><span>&copy; 2025</span>
<span>Huong Do</span>
<span><a href=/posts/index.xml target=_blank title=rss><svg width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></span></div></div></footer></div><script type=text/javascript src=/bundle.min.f0a83284a6a9c303ebdedda40cff4fae081def9d6a9799f08d51f2779bc03f8a9c5b606d59895c8c0cd5297ce84850caae34b98aace4b455e992310ed26193ba.js integrity="sha512-8KgyhKapwwPr3t2kDP9Prggd751ql5nwjVHyd5vAP4qcW2BtWYlcjAzVKXzoSFDKrjS5iqzktFXpkjEO0mGTug=="></script></body></html>